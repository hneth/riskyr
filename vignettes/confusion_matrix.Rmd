---
title: "Confusion Matrix and Metrics"
author: "HansjÃ¶rg Neth, SPDS, uni.kn"
date: "`r Sys.Date()`"
output: 
  rmarkdown::html_vignette: 
    fig_caption: yes
vignette: >
  %\VignetteIndexEntry{Confusion Matrix and Metrics}
  %\VignetteEngine{knitr::rmarkdown}
  %\VignetteEncoding{UTF-8}
---

```{r setup, include = FALSE}
knitr::opts_chunk$set(
  collapse = TRUE,
  comment = "#>"
)
```

Behold the aptly named "confusion matrix":

|         | Condition           |     | 
| ------:  |:----:|:----:|------:|              
| **Decision** | `TRUE`:      | `FALSE`:    |     Sum:  | 
| positive:    | `hi`       | `fa`          | `dec.pos` | 
| negative:    | `mi`       | `cr`          | `dec.neg` | 
|      Sum:    | `cond.true` | `cond.false` |       `N` |

Ordinary people, but also medical experts and social scientists, struggle to understand the implications of this simple matrix. 
This is not surprising when viewing explanatory attempts like the corresponding article on [Wikipedia](https://en.wikipedia.org/wiki/Confusion_matrix), which squeezes more than a dozen metrics out of its four essential frequencies (`hi`, `mi`, `fa`, and `cr`). Although each particular metric is quite simple, their abundance and inter-dependence can be overwhelming. In the following, we try to summarize the parts that a risk-literate person really needs to know.

## Basics

In its most basic form, the confusion matrix looks like this:

|              | Condition    | 
| ------:      |:----:|:----:|      
| **Decision** | `TRUE`:  | `FALSE`: | 
| positive:    | `hi`     | `fa`     | 
| negative:    | `mi`     | `cr`     | 

Two perspectives, resulting from splitting a population of `N` individuals by two binary criteria:

a. by condition

b. by decision

This results in $2 \times 2 = 4$ cases.

Four cells are the essential core of all metrics.

Identify 2 correct cases (`hi`, `cr`) and 2 errors (`mi`, `fa`).


Sources of confusion: 

- `mi` are in the `cond.true` column (left), but "false negatives".
- `cr` are in the `cond.false` column (right), but "true negatives".

Thus, the terms "false" and "true" in cell names refer to the relationship between or correspondence of condition and decision, rather than the condition alone.


## Relationships

Overall, the following relationships hold among the frequencies:

$$ 
\begin{aligned}
\texttt{N} &= \texttt{hi} + \texttt{mi} + \texttt{fa} + \texttt{cr} \\
           &= \texttt{cond.true} + \texttt{cond.false} \\
           &= \texttt{dec.pos} + \texttt{dec.neg}      \\
           &= \texttt{dec.cor} + \texttt{dec.err}      \\
\end{aligned}
$$ 

Different perspectives:

(a) The 2 columns of the confusion table:

$$ 
\begin{aligned}
\texttt{cond.true}  &= \texttt{hi} + \texttt{mi} \\
\texttt{cond.false} &= \texttt{fa} + \texttt{cr} \\
\end{aligned}
$$ 

(b) The 2 rows of the confusion table:

$$ 
\begin{aligned}
\texttt{dec.pos}  &= \texttt{hi} + \texttt{fa} \\
\texttt{dec.neg}  &= \texttt{mi} + \texttt{cr} \\
\end{aligned}
$$ 




## Metrics

Accuracy as a dependent measure: some combination of correct and incorrect decisions.

(c) The 2 diagonals of the confusion table:

$$ 
\begin{aligned}
\texttt{dec.cor}      &= \texttt{hi} + \texttt{cr} \\
\texttt{dec.err}      &= \texttt{mi} + \texttt{fa} \\
\end{aligned}
$$ 

Note that it may be tempting to call instances of `dec.corr` and `dec.err` as "true decisions" and "false decisions". 
However, this would invite conceptual confusion, as "true decisions" actually include `cond.false` cases (`cr`) and "false decisions" actually include `cond.true` cases (`mi`).



### Accuracy `acc`

> Accuracy := Proportion or percentage of cases correctly classified.

$$
\begin{aligned}
\texttt{acc} &= \frac{\texttt{hi} + \texttt{cr}}{\texttt{hi} + \texttt{mi} + \texttt{fa} + \texttt{cr}} 
             = \frac{\texttt{dec.cor}}{\texttt{dec.cor} + \texttt{dec.err}} = \frac{\texttt{dec.cor}}{\texttt{N}}  
\end{aligned}
$$


### Weighted accuracy `wacc`

Weighted accuracy: Taking into account the importance of errors.



### Matthew correlation coefficient `mcc`

3. Matthew correlation coefficient (mcc)


## References

Links to Wikipedia articles:

- [Confusion matrix](https://en.wikipedia.org/wiki/Confusion_matrix) (URL: https://en.wikipedia.org/wiki/Confusion_matrix)



## All `riskyr` Vignettes

- [User guide](user_guide.html)
- [Data formats](data_formats.html)
- [Confusion matrix](confusion_matrix.html)

<!-- eof. -->




# Template

Vignettes are long form documentation commonly included in packages. Because they are part of the distribution of the package, they need to be as compact as possible. The `html_vignette` output type provides a custom style sheet (and tweaks some options) to ensure that the resulting html is as small as possible. The `html_vignette` format:

- Never uses retina figures
- Has a smaller default figure size
- Uses a custom CSS stylesheet instead of the default Twitter Bootstrap style

## Vignette Info

Note the various macros within the `vignette` section of the metadata block above. These are required in order to instruct R how to build the vignette. Note that you should change the `title` field and the `\VignetteIndexEntry` to match the title of your vignette.

## Styles

The `html_vignette` template includes a basic CSS theme. To override this theme you can specify your own CSS in the document metadata as follows:

    output: 
      rmarkdown::html_vignette:
        css: mystyles.css

## Figures

The figure sizes have been customised so that you can easily put two images side-by-side. 

```{r, fig.show='hold'}
plot(1:10)
plot(10:1)
```

You can enable figure captions by `fig_caption: yes` in YAML:

    output:
      rmarkdown::html_vignette:
        fig_caption: yes

Then you can use the chunk option `fig.cap = "Your figure caption."` in **knitr**.

## More Examples

You can write math expressions, e.g. $Y = X\beta + \epsilon$, footnotes^[A footnote here.], and tables, e.g. using `knitr::kable()`.

```{r, echo=FALSE, results='asis'}
knitr::kable(head(mtcars, 10))
```

Also a quote using `>`:

> "He who gives up [code] safety for [code] speed deserves neither."
([via](https://twitter.com/hadleywickham/status/504368538874703872))
